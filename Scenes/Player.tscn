[gd_scene load_steps=11 format=3 uid="uid://durf4fw0iv0bu"]

[ext_resource type="Texture2D" uid="uid://r4xsw1gbcaka" path="res://Assets/catwalknb_sheet.png" id="1_rpqav"]

[sub_resource type="GDScript" id="GDScript_kyqiw"]
resource_name = "Player "
script/source = "extends CharacterBody2D

class_name Player

signal health_change # Will need to be emitted when player takes damage  or heals

@export var maxHealth = 100
@onready var current_health: int = 100

@onready var attackHitBox = $AttackArea01/AttackHitBox
@onready var playerHitBox = $HitBox


const SPEED = 250.0
const JUMP_VELOCITY = -250.0

var jumped = 0
var isAttacking = false

#func _ready():
	
var can_take_damage: bool = true



func _physics_process(delta):
	# Add the gravity.
	if not is_on_floor():
		velocity += get_gravity() * delta

	# Handle jump.
	if Input.is_action_just_pressed(\"jump\") and (jumped < 2):
		velocity.y = JUMP_VELOCITY
		jumped += 1
	if is_on_floor():
		jumped = 0
	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var direction = Input.get_axis(\"ui_left\", \"ui_right\")
	if direction:
		velocity.x = direction * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)

	move_and_slide()
func _process(delta):
	if Input.is_action_just_pressed(\"attack\") and not isAttacking:
		isAttacking = true; 
		attack()

func attack():
	
	attackHitBox.disabled = false; # Attack hit box activated
	await get_tree().create_timer(0.5).timeout  # wait half a second
	attackHitBox.disabled = true;
	isAttacking = false; 
	
	
func take_damage(amount: int):
	if not can_take_damage:
		return  # ignore if still in cooldown

	current_health -= amount
	health_change.emit(current_health) # signals to the hud to update the health bar

	can_take_damage = false
	# start cooldown
	var timer = get_tree().create_timer(1.0) # 1 second delay
	timer.timeout.connect(_on_damage_cooldown_finished)

	
	current_health -= amount
	
	health_change.emit()
	pass
	
func _on_damage_cooldown_finished():
		can_take_damage = true
"

[sub_resource type="AtlasTexture" id="AtlasTexture_kyqiw"]
atlas = ExtResource("1_rpqav")
region = Rect2(223, 0, 208, 291)

[sub_resource type="AtlasTexture" id="AtlasTexture_gntrk"]
atlas = ExtResource("1_rpqav")
region = Rect2(436, 0, 208, 291)

[sub_resource type="AtlasTexture" id="AtlasTexture_dewec"]
atlas = ExtResource("1_rpqav")
region = Rect2(223, 291, 208, 291)

[sub_resource type="AtlasTexture" id="AtlasTexture_5ixxa"]
atlas = ExtResource("1_rpqav")
region = Rect2(436, 291, 208, 291)

[sub_resource type="AtlasTexture" id="AtlasTexture_nn08x"]
atlas = ExtResource("1_rpqav")
region = Rect2(649, 0, 208, 291)

[sub_resource type="SpriteFrames" id="SpriteFrames_52ee3"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_kyqiw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gntrk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dewec")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5ixxa")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nn08x")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_bhhdu"]
radius = 28.0
height = 154.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_rpqav"]
size = Vector2(107, 141)

[node name="Cat" type="CharacterBody2D"]
script = SubResource("GDScript_kyqiw")

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2(-1, -2)
scale = Vector2(0.3, 0.3)
zoom = Vector2(2, 2)

[node name="CatWalk" type="AnimatedSprite2D" parent="."]
position = Vector2(4.0000153, 3)
scale = Vector2(0.49534884, 0.59621996)
sprite_frames = SubResource("SpriteFrames_52ee3")
autoplay = "default"
frame_progress = 0.2078868

[node name="HitBox" type="CollisionShape2D" parent="."]
position = Vector2(22, 5)
shape = SubResource("CapsuleShape2D_bhhdu")

[node name="AttackArea01" type="Area2D" parent="."]
position = Vector2(3, 3)
collision_layer = 2
collision_mask = 4

[node name="AttackHitBox" type="CollisionShape2D" parent="AttackArea01"]
top_level = true
position = Vector2(106, 0)
shape = SubResource("RectangleShape2D_rpqav")
disabled = true
debug_color = Color(0.32317686, 0.5522869, 0.7861259, 0.41960785)
